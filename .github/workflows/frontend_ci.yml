# week08/.github/workflows/frontend_ci.yml

name: Frontend CI - Build & Push (ACR admin auth)

on:
  workflow_dispatch:
  push:
    branches: [main]
    paths:
      - "frontend/**"
      - ".github/workflows/frontend_ci.yml"

env:
  # e.g. belieliu27w08acr.azurecr.io
  ACR_LOGIN_SERVER: ${{ secrets.ACR_LOGIN_SERVER }}

jobs:
  build_and_push_frontend:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Use ACR admin creds instead of Azure login / SP
      - name: Docker login to ACR (admin user)
        run: echo "${{ secrets.ACR_PASSWORD }}" | docker login ${{ env.ACR_LOGIN_SERVER }} -u "${{ secrets.ACR_USERNAME }}" --password-stdin

      - name: Build & push frontend
        run: |
          docker build -t ${{ env.ACR_LOGIN_SERVER }}/frontend:latest ./frontend
          docker push  ${{ env.ACR_LOGIN_SERVER }}/frontend:latest
